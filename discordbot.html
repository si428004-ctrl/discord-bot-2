<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Fallen Phoenix Bot Panel</title>
  <style>
    :root {
      --bg-main: #0f1117;
      --bg-card: #1a1d29;
      --bg-card-alt: #22263a;
      --txt-main: #fff;
      --txt-dim: #9ca3af;
      --accent: #ff4d00;
      --radius-xl: 16px;
      --radius-lg: 10px;
      --border-col: rgba(255,255,255,0.07);
      --input-bg: rgba(255,255,255,0.05);
    }

    body {
      background: var(--bg-main);
      color: var(--txt-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", Roboto, "Segoe UI", sans-serif;
      margin: 0;
      padding: 24px;
      line-height: 1.4;
    }

    .layout {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0,1fr) 320px;
      gap: 24px;
    }

    header.app-header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .title-wrap h1 {
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-wrap h1 .dot {
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 999px;
      box-shadow: 0 0 12px var(--accent);
    }

    .title-wrap .sub {
      font-size: .8rem;
      color: var(--txt-dim);
      margin-top: 2px;
    }

    .top-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    button.btn {
      appearance: none;
      border: 0;
      border-radius: var(--radius-lg);
      background: var(--accent);
      color: #fff;
      font-size: .8rem;
      font-weight: 600;
      line-height: 1;
      padding: 10px 14px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(255,77,0,.3);
    }
    button.btn.sec {
      background: transparent;
      color: var(--txt-main);
      border: 1px solid var(--border-col);
      box-shadow: none;
    }
    button.btn:active {
      transform: scale(.98);
    }

    .btn.small {
      font-size: .7rem;
      padding: 8px 10px;
      line-height: 1.1;
    }

    /* header toggle */
    .header-toggle {
      display:flex;
      gap:10px;
      align-items:center;
      padding:6px 10px;
      border-radius:10px;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-col);
      font-size: .8rem;
      color: var(--txt-dim);
    }
    .header-toggle input[type="checkbox"]{
      width:18px;
      height:18px;
      accent-color: var(--accent);
      cursor: pointer;
    }

    /* cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-col);
      border-radius: var(--radius-xl);
      padding: 16px 20px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card-header {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }

    .card-header .left .label {
      font-size: .75rem;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--accent);
      font-weight: 600;
    }
    .card-header .left h2 {
      font-size: .95rem;
      font-weight: 600;
      color: #fff;
      margin: 2px 0 0;
    }
    .card-header .left .desc {
      font-size: .8rem;
      color: var(--txt-dim);
      margin-top: 2px;
      max-width: 800px;
      line-height: 1.4;
      white-space: pre-line;
    }

    .section-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(min(260px,100%),1fr));
      gap: 16px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .field-row {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .field label {
      font-size: .75rem;
      font-weight: 500;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .hint {
      font-size: .7rem;
      color: var(--txt-dim);
      line-height: 1.3;
      white-space: pre-line;
    }

    input.txt,
    textarea.txt,
    select.txt {
      width: 100%;
      background: var(--input-bg);
      color: #fff;
      font-size: .8rem;
      line-height: 1.4;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-col);
      padding: 10px 12px;
      font-family: inherit;
      outline: none;
    }
    textarea.txt {
      min-height: 80px;
      resize: vertical;
    }
    input.color {
      width: 44px;
      height: 36px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-col);
      background: var(--input-bg);
      cursor: pointer;
    }

    .mini-card {
      background: var(--bg-card-alt);
      border: 1px solid var(--border-col);
      border-radius: var(--radius-lg);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: .8rem;
    }

    /* reaction roles layout tweak */
    .reaction-row {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr 0.8fr auto;
      gap: 8px;
      align-items: flex-start;
      font-size: .8rem;
      margin-bottom: 8px;
    }

    .reaction-row .emoji-box {
      display: flex;
      align-items: center;
      background: var(--input-bg);
      border: 1px solid var(--border-col);
      border-radius: var(--radius-lg);
      min-height: 36px;
      padding: 8px 10px;
      font-size: .75rem;
      line-height: 1.2;
      cursor: text;
      color: #fff;
      width: 100%;
      min-width: 0;
      overflow: hidden;
      white-space: nowrap;
    }

    .reaction-row input.txt {
      width: 100%;
      min-width: 0;
      padding: 8px 10px;
      font-size: .75rem;
      line-height: 1.2;
    }

    .reaction-hint {
      grid-column: 1 / -1;
      font-size: .7rem;
      color: var(--txt-dim);
      line-height: 1.3;
      margin-top: -4px;
      margin-bottom: 16px;
    }

    .avatar-card {
      text-align: center;
    }
    .avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      border: 2px solid var(--border-col);
      background-size: cover;
      background-position: center;
      margin: 0 auto 8px;
    }
    .avatar-filename {
      font-size: .7rem;
      color: var(--txt-dim);
      word-break: break-all;
    }

    .footer-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }

    @media(max-width: 900px){
      .layout {
        grid-template-columns: 1fr;
      }
      header.app-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
      .top-actions {
        width: 100%;
        flex-wrap: wrap;
      }
    }

    .split-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(320px,100%),1fr));
      gap: 16px;
    }

    .subcard-block {
      background: var(--bg-card-alt);
      border: 1px solid var(--border-col);
      border-radius: var(--radius-lg);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: .8rem;
    }

    .subcard-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: flex-start;
    }

    .subcard-row .field {
      flex: 1;
      min-width: 0;
    }

    .subcard-row .field.color-field {
      flex: 0 0 auto;
      width: 70px;
      min-width: 70px;
    }

    /* LOG MODAL */
    .log-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 9999;
    }

    .log-modal {
      background: var(--bg-card);
      border: 1px solid var(--border-col);
      border-radius: var(--radius-xl);
      width: min(800px, 100%);
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 30px 100px rgba(0,0,0,0.8);
    }

    .log-modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-col);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .log-modal-header h3 {
      color: #fff;
      font-size: .9rem;
      margin: 0;
      font-weight: 600;
    }
    .log-close-btn {
      background: transparent;
      color: var(--txt-dim);
      border: 1px solid var(--border-col);
      border-radius: var(--radius-lg);
      font-size: .7rem;
      font-weight: 500;
      padding: 6px 10px;
      cursor: pointer;
    }

    .log-modal-body {
      padding: 16px 20px;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: .7rem;
      line-height: 1.4;
      color: var(--txt-main);
      white-space: pre;
      background: #0c0e14;
      border-bottom-left-radius: var(--radius-xl);
      border-bottom-right-radius: var(--radius-xl);
    }

    .log-modal-body pre {
      margin: 0;
      color: var(--txt-main);
    }
  </style>
</head>
<body>

  <div class="layout">

    <!-- HEADER -->
    <header class="app-header">
      <div class="title-wrap">
        <h1>
          <span class="dot"></span>
          Fallen Phoenix ‚Ä¢ Admin panel
        </h1>
        <div class="sub">Rychl√Ω √∫pravy bez ≈°≈•our√°n√≠ se v k√≥du üòÆ‚Äçüí®</div>
      </div>

      <div class="top-actions">
        <!-- NEW: header verify toggle -->
        <div class="header-toggle" title="Zapnout/vypnout ovƒõ≈ôov√°n√≠ nov√°ƒçk≈Ø">
          <input type="checkbox" id="requireVerifyHeader" />
          <div style="display:flex;flex-direction:column;">
            <div style="font-weight:600;color:#fff;font-size:.85rem;">Verify</div>
            <div style="font-size:.7rem;color:var(--txt-dim);">Vy≈æadovat ovƒõ≈ôen√≠</div>
          </div>
        </div>

        <button class="btn sec" onclick="openLogs()">Logs</button>
      </div>
    </header>

    <!-- MAIN COLUMN -->
    <main class="main-col" style="display:flex;flex-direction:column;gap:24px;">

      <!-- BOT INFO -->
      <section class="card" id="botInfoCard">
        <div class="card-header">
          <div class="left">
            <div class="label">Bot</div>
            <h2>Identita bota</h2>
            <div class="desc">Jm√©no, status a vibe bota na Discordu.</div>
          </div>
        </div>

        <div class="section-grid">
          <div class="field">
            <label>Jm√©no bota (display name)</label>
            <input id="botDisplayName" class="txt" placeholder="Fallen Phoenix" />
            <div class="hint">Tohle je jak se bot prezentuje ve≈ôejnƒõ.</div>
          </div>

          <div class="field">
            <label>Status text (custom status)</label>
            <input id="botStatus" class="txt" placeholder="üî• Ready to burn" />
            <div class="hint">Nap≈ô. "Watching over the server", "type /verify"</div>
          </div>
        </div>

        <div class="footer-actions">
          <button class="btn sec" onclick="resetBotInfo()">Zru≈°it zmƒõny</button>
          <button class="btn" onclick="saveBotInfo()">Ulo≈æit</button>
        </div>
      </section>

      <!-- CHANNELS / ROLES / IDs -->
      <section class="card" id="idCard">
        <div class="card-header">
          <div class="left">
            <div class="label">Server</div>
            <h2>Kan√°ly, role a IDƒçka</h2>
            <div class="desc">
              Tohle ≈ô√≠k√° botovi, kam m√° ps√°t logy, kde je ovƒõ≈ôov√°n√≠, kter√Ω role d√°v√° atd.
              Kdy≈æ tady nƒõco p≈ôep√≠≈°e≈°, nehrabe≈° se do logiky bota ‚Äì jen mu uk√°≈æe≈° jin√Ω kan√°l/roli.
            </div>
          </div>
        </div>

        <div class="section-grid">
          <div class="field">
            <label>Guild ID</label>
            <input id="guildId" class="txt" />
            <div class="hint">ID tv√Ωho hlavn√≠ho serveru.</div>
          </div>

          <div class="field">
            <label>Channel: Verifikace nov√°ƒçk≈Ø</label>
            <input id="welcomeChannelId" class="txt" />
            <div class="hint">Sem bot po joinu p√≠≈°e ot√°zku ‚Äúproƒç chce≈° sem b√Ωt?‚Äù</div>
          </div>

          <div class="field">
            <label>Channel: Log na schv√°len√≠ (JOIN_LOG)</label>
            <input id="joinLogChannelId" class="txt" />
            <div class="hint">Sem chod√≠ embed s odpovƒõd√≠ nov√°ƒçka a modov√© tam klikaj√≠ ‚úÖ / ‚ùå</div>
          </div>

          <div class="field">
            <label>Channel: Reaction role v√Ωbƒõr</label>
            <input id="roleSelectChannelId" class="txt" />
            <div class="hint">Kan√°l kde je embed ‚ÄúJakou linku main√≠≈°?‚Äù</div>
          </div>

          <div class="field">
            <label>Channel: Nazdar / welcome embed</label>
            <input id="nazdarChannelId" class="txt" />
            <div class="hint">Sem chod√≠ ten ve≈ôejnej ‚ÄúN A Z D A R !‚Äù embed.</div>
          </div>

          <div class="field">
            <label>Channel: Odchody & bany</label>
            <input id="leaveBanChannelId" class="txt" />
            <div class="hint">‚ÄúXYZ opustil server.‚Äù / ‚ÄúXYZ dostal BAN!‚Äù</div>
          </div>

          <div class="field">
            <label>Channel: Online log</label>
            <input id="onlineLogChannelId" class="txt" />
            <div class="hint">Sem bot h√°z√≠ ‚Äúüü¢ Bot je zpƒõt online‚Äù a /ban embed logy.</div>
          </div>

          <div class="field">
            <label>Channel: Poƒçet members</label>
            <input id="memberStatsChannelId" class="txt" />
            <div class="hint">Kan√°l kter√©mu bot mƒõn√≠ n√°zev na ‚Äúüî¢Ô∏±M·¥á·¥ç ô·¥á Äs: X‚Äù.</div>
          </div>

          <div class="field">
            <label>Channel: Poƒçet neovƒõ≈ôen√Ωch</label>
            <input id="unverifiedStatsChannelId" class="txt" />
            <div class="hint">Kan√°l kter√©mu bot mƒõn√≠ n√°zev na ‚Äú‚ùîÔ∏±U…¥·¥†·¥á Ä…™“ì…™·¥á·¥Ö: Y‚Äù.</div>
          </div>

          <div class="field">
            <label>Role ID: VERIFIED</label>
            <input id="verifiedRoleId" class="txt" />
            <div class="hint">Tohle d√°v√°me po schv√°len√≠ ‚úÖ</div>
          </div>

          <div class="field">
            <label>Role ID: UNVERIFIED</label>
            <input id="unverifiedRoleId" class="txt" />
            <div class="hint">Tohle dostane novej ƒçlen po joinu, dokud neprojde.</div>
          </div>

          <div class="field">
            <label>Felƒçour ID bota (FALLEN_PHOENIX_ID)</label>
            <input id="fallenPhoenixId" class="txt" />
            <div class="hint">ID kter√Ω nechce≈° poƒç√≠tat do statistik members.</div>
          </div>
        </div>

        <div class="footer-actions">
          <button class="btn sec" onclick="resetIds()">Zru≈°it zmƒõny</button>
          <button class="btn" onclick="saveIds()">Ulo≈æit</button>
        </div>
      </section>

      <!-- WELCOME / VERIFY FLOW -->
      <section class="card" id="welcomeEmbedCard">
        <div class="card-header">
          <div class="left">
            <div class="label">Welcome & Verify</div>
            <h2>Uv√≠tac√≠ zpr√°va a ovƒõ≈ôen√≠ nov√°ƒçk≈Ø</h2>
            <div class="desc">
              1) Ve≈ôejn√Ω uv√≠tac√≠ embed (‚ÄúN A Z D A R !‚Äù)
              2) Ot√°zka v kan√°lu pro ovƒõ≈ôen√≠
              3) Embed pro moder√°tory s odpovƒõd√≠ nov√°ƒçka + approve/deny texty
            </div>
          </div>
        </div>

        <div class="section-grid">
          <div class="field">
            <label>Uv√≠tac√≠ embed: Titulek</label>
            <input id="welcomeTitle" class="txt" placeholder="N A Z D A R !" />
          </div>

          <div class="field">
            <label>Uv√≠tac√≠ embed: Barva</label>
            <input id="welcomeColor" class="color" type="color" />
            <div class="hint">Barva lev√©ho pruhu embedu (HEX)</div>
          </div>

          <div class="field" style="grid-column:1 / -1;">
            <label>Uv√≠tac√≠ embed: Popis</label>
            <textarea id="welcomeDesc" class="txt" placeholder="V√≠tej {USER}! ..."></textarea>
            <div class="hint">Pou≈æij {USER} pro zm√≠nku nov√°ƒçka.</div>
          </div>
        </div>

        <div class="section-grid">
          <div class="field" style="grid-column:1 / -1;">
            <label>Verifikaƒçn√≠ ot√°zka</label>
            <textarea id="verifyQuestionText" class="txt" placeholder="Ahoj {USER}, pro schv√°len√≠ pot≈ôebujeme tvou odpovƒõƒè..."></textarea>
            <div class="hint">Tohle bot po≈°le nov√©mu ƒçlenovi v kan√°lu pro ovƒõ≈ôen√≠. {USER} = nov√°ƒçek.</div>
          </div>

          <div class="field" style="grid-column:1 / -1;">
            <label>D≈Øvod kicku po 24h bez odpovƒõdi</label>
            <input id="timeoutKickReason" class="txt" />
            <div class="hint">Tohle se zap√≠≈°e jako d≈Øvod p≈ôi kicku.</div>
          </div>

          <!-- P≈òID√ÅNO: Toggle verify (v hlavn√≠m obsahu taky) -->
          <div class="field" style="grid-column:1 / -1;">
            <div style="display:flex;align-items:center;gap:12px">
              <label style="display:flex;align-items:center;gap:8px;">
                <input type="checkbox" id="requireVerify" />
                <span style="font-weight:600;color:#fff">Vy≈æadovat ovƒõ≈ôen√≠ nov√°ƒçk≈Ø</span>
              </label>
            </div>
            <div class="hint">
              Kdy≈æ tohle je zapnut√©, bot nov√Ωm ƒçlen≈Øm p≈ôi≈ôad√≠ <strong>UNVERIFIED</strong> a po≈°le ovƒõ≈ôovac√≠ ot√°zku. Kdy≈æ je vypnut√©, nov√≠ dostanou <strong>VERIFIED</strong> a ot√°zka se nepos√≠l√°.
            </div>
          </div>
        </div>

        <div class="mini-card">
          <div class="field">
            <label>Embed pro moder√°tory: Titulek</label>
            <input id="modLogTitle" class="txt" />
          </div>

          <div class="field">
            <label>Embed pro moder√°tory: Barva</label>
            <input id="modLogColor" class="color" type="color" />
          </div>

          <div class="field">
            <label>Embed pro moder√°tory: Tƒõlo (odpovƒõƒè nov√°ƒçka)</label>
            <textarea id="modLogDescription" class="txt"></textarea>
            <div class="hint">
              {USER} = ping na ƒçlena
              {ANSWER} = jeho odpovƒõƒè
            </div>
          </div>

          <div class="field-row" style="width:100%;">
            <div class="field" style="flex:1;">
              <label>Schv√°leno ‚úÖ text</label>
              <textarea id="approveText" class="txt"></textarea>
              <div class="hint">{USER} = ten nov√Ω ƒçlen, {MOD} = moder√°tor co klikl ‚úÖ</div>
            </div>

            <div class="field">
              <label>Schv√°leno ‚úÖ barva</label>
              <input id="approveColor" class="color" type="color" />
            </div>
          </div>

          <div class="field-row" style="width:100%;">
            <div class="field" style="flex:1;">
              <label>Zam√≠tnuto ‚ùå text</label>
              <textarea id="rejectText" class="txt"></textarea>
              <div class="hint">{USER} = nov√Ω ƒçlen, {MOD} = moder√°tor co klikl ‚ùå</div>
            </div>

            <div class="field">
              <label>Zam√≠tnuto ‚ùå barva</label>
              <input id="rejectColor" class="color" type="color" />
            </div>
          </div>
        </div>

        <div class="footer-actions">
          <button class="btn sec" onclick="resetWelcome()">Zru≈°it zmƒõny</button>
          <button class="btn" onclick="saveWelcome()">Ulo≈æit</button>
        </div>
      </section>

      <!-- REACTION ROLES -->
      <section class="card" id="reactionRolesCard">
        <div class="card-header">
          <div class="left">
            <div class="label">Reaction Roles</div>
            <h2>Role na emoji</h2>
            <div class="desc">
              Embed ‚ÄúJakou linku main√≠≈°?‚Äù + mapov√°n√≠ emoji ‚Üí role.
              Tohle ovlivn√≠, kdo dostane jakou roli po kliknut√≠.
            </div>
          </div>
          <button class="btn sec" onclick="addReactionRow()">+ P≈ôidat dal≈°√≠</button>
        </div>

        <div class="section-grid">
          <div class="field">
            <label>RR Embed: Titulek</label>
            <input id="rrTitle" class="txt" />
          </div>

          <div class="field">
            <label>RR Embed: Barva</label>
            <input id="rrColor" class="color" type="color" />
          </div>

          <div class="field" style="grid-column:1 / -1;">
            <label>RR Embed: Popis</label>
            <textarea id="rrDescription" class="txt"></textarea>
          </div>

          <div class="field">
            <label>RR Embed: Thumbnail URL</label>
            <input id="rrThumb" class="txt" />
          </div>

          <div class="field">
            <label>RR Embed: Image URL</label>
            <input id="rrImage" class="txt" />
          </div>
        </div>

        <div id="reactionList" class="mini-card">
          <!-- dynamicky ≈ô√°dky emoji/role -->
        </div>

        <div class="footer-actions">
          <button class="btn sec" onclick="resetReactions()">Zru≈°it zmƒõny</button>
          <button class="btn" onclick="saveReactions()">Ulo≈æit</button>
        </div>
      </section>

      <!-- LEAVE / BAN LOG TEXTY -->
      <section class="card" id="leaveBanCard">
        <div class="card-header">
          <div class="left">
            <div class="label">Odchody & Ban notifikace</div>
            <h2>Log zpr√°vy p≈ôi leavu a banu</h2>
            <div class="desc">
              Kdy≈æ nƒõkdo odejde nebo dostane ban, bot to nap√≠≈°e do
              kan√°lu Leave/Ban log. Tady si p≈ôep√≠≈°e≈° text a barvu.
            </div>
          </div>
        </div>

        <div class="split-2">
          <!-- LEFT = ODCHOD -->
          <div class="subcard-block">
            <div class="field">
              <label>Odchod: Text</label>
              <textarea id="leaveText" class="txt" placeholder="{USER} opustil server."></textarea>
              <div class="hint">{USER} = ten co leavnul</div>
            </div>

            <div class="subcard-row">
              <div class="field color-field">
                <label>Odchod: Barva</label>
                <input id="leaveColor" class="color" type="color" />
              </div>
            </div>
          </div>

          <!-- RIGHT = BAN -->
          <div class="subcard-block">
            <div class="field">
              <label>Ban: Text</label>
              <textarea id="banText" class="txt" placeholder="{USER} dostal BAN!"></textarea>
              <div class="hint">{USER} = ten zabanovanej</div>
            </div>

            <div class="subcard-row">
              <div class="field color-field">
                <label>Ban: Barva</label>
                <input id="banColor" class="color" type="color" />
              </div>
            </div>
          </div>
        </div>

        <div class="footer-actions">
          <button class="btn sec" onclick="resetLeaveBan()">Zru≈°it zmƒõny</button>
          <button class="btn" onclick="saveLeaveBan()">Ulo≈æit</button>
        </div>
      </section>

      <!-- BAN LOG (embed pro /ban) -->
      <section class="card" id="banLogCard">
        <div class="card-header">
          <div class="left">
            <div class="label">/ban log</div>
            <h2>Embed pos√≠lan√Ω p≈ôi /ban</h2>
            <div class="desc">
              To, co bot pos√≠l√° do Online Log kan√°lu po √∫spƒõ≈°n√©m /ban.
              M≈Ø≈æe≈° pou≈æ√≠t placeholdery:
              {USER} = ping na banovan√Ωho
              {USER_ID} = ID banovan√Ωho
              {MOD} = kdo banoval
              {REASON} = d≈Øvod
            </div>
          </div>
        </div>

        <div class="section-grid">
          <div class="field">
            <label>Nadpis embedu</label>
            <input id="banLogTitle" class="txt" placeholder="üö´ BAN" />
          </div>

          <div class="field">
            <label>Barva embedu</label>
            <input id="banLogColor" class="color" type="color" />
          </div>

          <div class="field" style="grid-column:1 / -1;">
            <label>Tƒõlo embedu</label>
            <textarea id="banLogDesc" class="txt" placeholder="**User:** {USER} ({USER_ID})&#10;**Banned by:** {MOD}&#10;**Reason:** {REASON}"></textarea>
          </div>
        </div>

        <div class="footer-actions">
          <button class="btn sec" onclick="resetBanLog()">Zru≈°it zmƒõny</button>
          <button class="btn" onclick="saveBanLog()">Ulo≈æit</button>
        </div>
      </section>

    </main>

    <!-- SIDE COLUMN -->
    <aside class="side-col" style="display:flex;flex-direction:column;gap:24px;">

      <!-- AVATAR -->
      <section class="card">
        <div class="card-header">
          <div class="left">
            <div class="label">Avatar</div>
            <h2>Logo bota</h2>
            <div class="desc">Tady m≈Ø≈æe≈° zmƒõnit profilovku bota (client.user.setAvatar).</div>
          </div>
        </div>

        <div class="avatar-card">
          <div id="avatarPreview" class="avatar-preview" style="background-image:url('https://placehold.co/160x160/png');"></div>
          <div class="avatar-filename" id="avatarFilename">≈Ω√°dn√Ω soubor</div>

          <input style="display:none" type="file" id="avatarInput" accept="image/*" />
          <button class="btn sec" style="width:100%;" onclick="document.getElementById('avatarInput').click()">Vybrat obr√°zek</button>
          <button class="btn" style="width:100%;" onclick="uploadAvatar()">Nastavit jako avatar bota</button>
          <div class="hint">Poƒç√≠t√°me s POST /upload-avatar ‚Üí server zavol√° client.user.setAvatar().</div>
        </div>
      </section>

      <!-- LOGY -->
      <section class="card">
        <div class="card-header">
          <div class="left">
            <div class="label">Runtime</div>
            <h2>Logy & stav</h2>
            <div class="desc">
              Posledn√≠ v√Ωpis z bƒõ≈æ√≠c√≠ instance bota (pamƒõ≈• proces≈Ø).
            </div>
          </div>
        </div>

        <div class="mini-card">
          <div class="field">
            <label>Debug</label>
            <div class="field-row" style="flex-wrap:wrap;gap:8px;">
              <button class="btn sec" onclick="openLogs()">Zobrazit logy</button>
            </div>
            <div class="hint">Tohle nejsou star√Ω deploy logy z Renderu, ale ≈æiv√Ω logy, co bot s√°m loguje.</div>
          </div>
        </div>
      </section>

    </aside>
  </div>

  <!-- LOG MODAL -->
  <div id="logModalBackdrop" class="log-modal-backdrop">
    <div class="log-modal">
      <div class="log-modal-header">
        <h3>Server log (posledn√≠ bƒõh)</h3>
        <button class="log-close-btn" onclick="closeLogs()">Zav≈ô√≠t</button>
      </div>
      <div class="log-modal-body">
        <pre id="logModalContent">Naƒç√≠t√°m‚Ä¶</pre>
      </div>
    </div>
  </div>

  <script>
    // Glob√°ln√≠ stav str√°nky naplnƒõn√Ω z /config
    let state = {};

    // === FETCH CONFIG + NAPLNƒöN√ç FORM≈Æ ===
    async function loadInitial() {
      try {
        const res = await fetch("/config");
        if (!res.ok) throw new Error("Fetch /config selhal");
        state = await res.json();

        // helpery
        const setVal = (id, val) => {
          const el = document.getElementById(id);
          if (el) el.value = val ?? "";
        };
        const setColor = (id, val) => {
          const el = document.getElementById(id);
          if (el) el.value = val ?? "#000000";
        };
        const setBgImage = (id, url) => {
          const el = document.getElementById(id);
          if (el && url) el.style.backgroundImage = `url('${url}')`;
        };

        // BOT IDENTITY
        if (state.botIdentity) {
          setVal('botDisplayName', state.botIdentity.displayName);
          setVal('botStatus', state.botIdentity.statusText);
        }

        // IDS / CHANNELS / ROLES
        if (state.channelsAndRoles) {
          setVal('guildId', state.channelsAndRoles.guildId);
          setVal('welcomeChannelId', state.channelsAndRoles.welcomeChannelId);
          setVal('joinLogChannelId', state.channelsAndRoles.joinLogChannelId);
          setVal('roleSelectChannelId', state.channelsAndRoles.roleSelectChannelId);
          setVal('nazdarChannelId', state.channelsAndRoles.nazdarChannelId);
          setVal('leaveBanChannelId', state.channelsAndRoles.leaveBanChannelId);
          setVal('onlineLogChannelId', state.channelsAndRoles.onlineLogChannelId);
          setVal('memberStatsChannelId', state.channelsAndRoles.memberStatsChannelId);
          setVal('unverifiedStatsChannelId', state.channelsAndRoles.unverifiedStatsChannelId);
          setVal('verifiedRoleId', state.channelsAndRoles.verifiedRoleId);
          setVal('unverifiedRoleId', state.channelsAndRoles.unverifiedRoleId);
          setVal('fallenPhoenixId', state.channelsAndRoles.fallenPhoenixId);
        }

        // WELCOME / VERIFY FLOW
        if (state.welcomeFlow) {
          const wf = state.welcomeFlow;
          if (wf.greetingEmbed) {
            setVal('welcomeTitle', wf.greetingEmbed.title);
            setColor('welcomeColor', wf.greetingEmbed.color);
            setVal('welcomeDesc', wf.greetingEmbed.description);
          }

          setVal('verifyQuestionText', wf.verifyQuestionText);
          setVal('timeoutKickReason', wf.timeoutKickReason);

          if (wf.modLogEmbed) {
            setVal('modLogTitle', wf.modLogEmbed.title);
            setColor('modLogColor', wf.modLogEmbed.color);
            setVal('modLogDescription', wf.modLogEmbed.descriptionTemplate);

            if (wf.modLogEmbed.approveMessage) {
              setVal('approveText', wf.modLogEmbed.approveMessage.textTemplate);
              setColor('approveColor', wf.modLogEmbed.approveMessage.color);
            }
            if (wf.modLogEmbed.rejectMessage) {
              setVal('rejectText', wf.modLogEmbed.rejectMessage.textTemplate);
              setColor('rejectColor', wf.modLogEmbed.rejectMessage.color);
            }
          }
        }

        // NEW: verify toggle state - sync both header and main checkboxes
        try {
          const chkMain = document.getElementById('requireVerify');
          const chkHeader = document.getElementById('requireVerifyHeader');

          const enabled = (typeof state.verifyEnabled !== 'undefined')
            ? !!state.verifyEnabled
            : !!(state.welcomeFlow && state.welcomeFlow.verifyQuestionText);

          if (chkMain) chkMain.checked = enabled;
          if (chkHeader) chkHeader.checked = enabled;

          // Attach listeners (idempotent)
          setupVerifyToggle();
        } catch (e) {
          console.warn("verify toggle load fail:", e);
        }

        // REACTION ROLES
        if (state.reactionRoles) {
          if (state.reactionRoles.embed) {
            setVal('rrTitle', state.reactionRoles.embed.title);
            setColor('rrColor', state.reactionRoles.embed.color);
            setVal('rrDescription', state.reactionRoles.embed.description);
            setVal('rrThumb', state.reactionRoles.embed.thumbnailUrl);
            setVal('rrImage', state.reactionRoles.embed.imageUrl);
          }
          renderReactionList();
        } else {
          // pokud reactionRoles v≈Øbec nen√≠, inicializuj aby p≈ôid√°v√°n√≠ fungovalo
          state.reactionRoles = { embed: {}, emojiRoleMap: [] };
          renderReactionList();
        }

        // LEAVE/BAN LOG
        if (state.leaveBanLogs) {
          if (state.leaveBanLogs.leave) {
            setVal('leaveText', state.leaveBanLogs.leave.textTemplate);
            setColor('leaveColor', state.leaveBanLogs.leave.color);
          }
          if (state.leaveBanLogs.ban) {
            setVal('banText', state.leaveBanLogs.ban.textTemplate);
            setColor('banColor', state.leaveBanLogs.ban.color);
          }
        }

        // BAN COMMAND LOG
        if (state.banCommandLog) {
          setVal('banLogTitle', state.banCommandLog.title);
          setColor('banLogColor', state.banCommandLog.color);
          setVal('banLogDesc', state.banCommandLog.descriptionTemplate);
        }

        // AVATAR PREVIEW
        setBgImage('avatarPreview', state.avatarPreviewUrl || "https://placehold.co/160x160/png");

        console.log("‚úÖ Dashboard naplnƒõn z config.json");
      } catch (err) {
        console.error("‚ùå Nepoda≈ôilo se naƒç√≠st config:", err);
        alert("Nepoda≈ôilo se naƒç√≠st konfiguraci bota üò≠");
      }
    }

    // Attach and sync verify toggles
    function setupVerifyToggle() {
      const mainChk = document.getElementById('requireVerify');
      const headChk = document.getElementById('requireVerifyHeader');

      if (!mainChk || !headChk) return;

      // prevent adding multiple handlers
      if (mainChk._verifyHandlerAttached) return;
      mainChk._verifyHandlerAttached = true;
      headChk._verifyHandlerAttached = true;

      const handler = (checked) => {
        // sync both UI elements
        mainChk.checked = checked;
        headChk.checked = checked;
        // call save
        saveVerify(checked);
      };

      mainChk.addEventListener('change', (e) => handler(e.target.checked));
      headChk.addEventListener('change', (e) => handler(e.target.checked));
    }

    // === REACTION ROLES RENDER ===
    function renderReactionList() {
      const wrap = document.getElementById('reactionList');
      if (!wrap) return;

      wrap.innerHTML = "";

      const arr = state.reactionRoles?.emojiRoleMap || [];
      arr.forEach((row, idx) => {
        const rowDiv = document.createElement('div');
        rowDiv.className = "reaction-row";

        rowDiv.innerHTML = `
          <div class="emoji-box" contenteditable="true" data-idx="${idx}" data-field="emoji">${row.emoji || ""}</div>
          <input class="txt" data-idx="${idx}" data-field="label" placeholder="Popisek role" value="${row.label || ''}">
          <input class="txt" data-idx="${idx}" data-field="roleId" placeholder="Role ID" value="${row.roleId || ''}">
          <button class="btn sec small" onclick="removeReactionRow(${idx})">Smazat</button>
        `;

        const hintDiv = document.createElement('div');
        hintDiv.className = "reaction-hint";
        hintDiv.textContent = "Emoji m≈Ø≈æe b√Ωt buƒè klasick√Ω üî• nebo custom z tv√Ωho serveru ve form√°tu <:nazev:123456789012345678>. Role ID = ID role, kterou bot p≈ôid√°.";

        wrap.appendChild(rowDiv);
        wrap.appendChild(hintDiv);
      });
    }

    function addReactionRow(){
      if (!state.reactionRoles) state.reactionRoles = {};
      if (!state.reactionRoles.emojiRoleMap) state.reactionRoles.emojiRoleMap = [];
      state.reactionRoles.emojiRoleMap.push({ emoji: "‚ú®", roleId: "", label: "" });
      renderReactionList();
    }

    function removeReactionRow(i){
      state.reactionRoles.emojiRoleMap.splice(i,1);
      renderReactionList();
    }

    // === SAVE HANDLERS ===

    // 1) BOT IDENTITY
    function saveBotInfo() {
      const displayName = document.getElementById("botDisplayName").value.trim();
      const statusText = document.getElementById("botStatus").value.trim();

      fetch("/save-botsettings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ displayName, statusText })
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert(`‚úÖ Ulo≈æeno! Bot se pokus√≠ p≈ôejmenovat na "${displayName}" a zmƒõnit status.`);
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠: " + (resp.error || "nezn√°m√° chyba"));
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepovedlo se spojit se serverem.");
      });
    }

    function resetBotInfo(){
      loadInitial();
    }

    // 2) CHANNELS / ROLES / IDs
    function saveIds(){
      const body = {
        guildId: document.getElementById('guildId').value.trim(),
        welcomeChannelId: document.getElementById('welcomeChannelId').value.trim(),
        joinLogChannelId: document.getElementById('joinLogChannelId').value.trim(),
        roleSelectChannelId: document.getElementById('roleSelectChannelId').value.trim(),
        nazdarChannelId: document.getElementById('nazdarChannelId').value.trim(),
        leaveBanChannelId: document.getElementById('leaveBanChannelId').value.trim(),
        onlineLogChannelId: document.getElementById('onlineLogChannelId').value.trim(),
        memberStatsChannelId: document.getElementById('memberStatsChannelId').value.trim(),
        unverifiedStatsChannelId: document.getElementById('unverifiedStatsChannelId').value.trim(),
        verifiedRoleId: document.getElementById('verifiedRoleId').value.trim(),
        unverifiedRoleId: document.getElementById('unverifiedRoleId').value.trim(),
        fallenPhoenixId: document.getElementById('fallenPhoenixId').value.trim()
      };

      fetch("/save-ids", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert("‚úÖ IDs ulo≈æen√Ω. Bot teƒè pojede s novejma kan√°lama/rolama.");
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ IDƒçek: " + (resp.error || "nezn√°m√° chyba"));
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepovedlo se spojit se serverem (/save-ids).");
      });
    }

    function resetIds(){
      loadInitial();
    }

    // 3) WELCOME / VERIFY / APPROVE-DENY
    function saveWelcome(){
      const body = {
        greetingEmbed: {
          title: document.getElementById('welcomeTitle').value.trim(),
          color: document.getElementById('welcomeColor').value,
          description: document.getElementById('welcomeDesc').value.trim()
        },
        verifyQuestionText: document.getElementById('verifyQuestionText').value.trim(),
        timeoutKickReason: document.getElementById('timeoutKickReason').value.trim(),
        modLogEmbed: {
          title: document.getElementById('modLogTitle').value.trim(),
          color: document.getElementById('modLogColor').value,
          descriptionTemplate: document.getElementById('modLogDescription').value.trim(),
          approveMessage: {
            textTemplate: document.getElementById('approveText').value.trim(),
            color: document.getElementById('approveColor').value
          },
          rejectMessage: {
            textTemplate: document.getElementById('rejectText').value.trim(),
            color: document.getElementById('rejectColor').value
          }
        }
      };

      fetch("/save-welcome", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert("‚úÖ Welcome flow ulo≈æen√Ω. Nov√≠ joiny u≈æ jedou podle tohohle.");
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ welcome nastaven√≠.");
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepoda≈ôilo se spojit se serverem (/save-welcome).");
      });
    }

    function resetWelcome(){
      loadInitial();
    }

    // NEW: save verify toggle
    async function saveVerify(checked) {
      try {
        const res = await fetch("/save-verify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ verifyEnabled: !!checked })
        });
        const j = await res.json();
        if (j.ok) {
          console.log("verify saved ->", checked);
          // update local state and re-load if needed
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ verify: " + (j.error || "nezn√°m√° chyba"));
        }
      } catch (err) {
        console.error("saveVerify error", err);
        alert("‚ùå Nepoda≈ôilo se ulo≈æit verify (server nedostupn√Ω).");
      }
    }

    // 4) REACTION ROLES
    function saveReactions(){
      // seber embed settings
      const embedBlock = {
        title: document.getElementById('rrTitle').value.trim(),
        color: document.getElementById('rrColor').value,
        description: document.getElementById('rrDescription').value.trim(),
        thumbnailUrl: document.getElementById('rrThumb').value.trim(),
        imageUrl: document.getElementById('rrImage').value.trim()
      };

      // seber jednotliv√Ω ≈ô√°dky emoji/role
      const rows = [];
      const rowEls = document.querySelectorAll('#reactionList .reaction-row');
      rowEls.forEach(rowEl => {
        const emoji = rowEl.querySelector('.emoji-box').innerText.trim();
        const label = rowEl.querySelector('input[data-field="label"]').value.trim();
        const roleId = rowEl.querySelector('input[data-field="roleId"]').value.trim();
        if (emoji || roleId || label) {
          rows.push({ emoji, label, roleId });
        }
      });

      const body = {
        embed: embedBlock,
        emojiRoleMap: rows
      };

      fetch("/save-reactionroles", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert("‚úÖ Reaction roles ulo≈æen√Ω.");
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ reaction roles: " + (resp.error || "nezn√°m√° chyba"));
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepovedlo se spojit se serverem (/save-reactionroles).");
      });
    }

    function resetReactions(){
      loadInitial();
    }

    // 5) LEAVE / BAN LOG
    function saveLeaveBan(){
      const body = {
        leave: {
          textTemplate: document.getElementById('leaveText').value.trim(),
          color: document.getElementById('leaveColor').value
        },
        ban: {
          textTemplate: document.getElementById('banText').value.trim(),
          color: document.getElementById('banColor').value
        }
      };

      fetch("/save-leaveban", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert("‚úÖ Leave/Ban log zpr√°vy ulo≈æen√Ω.");
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ leave/ban: " + (resp.error || "nezn√°m√° chyba"));
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepovedlo se spojit se serverem (/save-leaveban).");
      });
    }

    function resetLeaveBan(){
      loadInitial();
    }

    // 6) BAN LOG (co se pos√≠l√° do onlineLogChannelId po /ban)
    function saveBanLog(){
      const body = {
        title: document.getElementById('banLogTitle').value.trim(),
        color: document.getElementById('banLogColor').value,
        descriptionTemplate: document.getElementById('banLogDesc').value.trim()
      };

      fetch("/save-banlog", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert("‚úÖ /ban log embed ulo≈æen√Ω.");
          loadInitial();
        } else {
          alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ ban logu: " + (resp.error || "nezn√°m√° chyba"));
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepovedlo se spojit se serverem (/save-banlog).");
      });
    }

    function resetBanLog(){
      loadInitial();
    }

    // AVATAR PREVIEW + upload
    const avatarInput = document.getElementById('avatarInput');
    avatarInput.addEventListener('change', () => {
      const file = avatarInput.files[0];
      if (!file) return;
      document.getElementById('avatarFilename').innerText = file.name;

      const reader = new FileReader();
      reader.onload = e => {
        document.getElementById('avatarPreview').style.backgroundImage = `url('${e.target.result}')`;
      };
      reader.readAsDataURL(file);
    });

    function uploadAvatar(){
      const file = avatarInput.files[0];
      if (!file) {
        alert("Nejd≈ô√≠v vyber obr√°zek üíÄ");
        return;
      }

      const formData = new FormData();
      // "avatarFile" se MUS√ç jmenovat stejnƒõ jako upload.single("avatarFile") v index.js
      formData.append("avatarFile", file);

      fetch("/upload-avatar", {
        method: "POST",
        body: formData
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.ok) {
          alert("‚úÖ Avatar zmƒõnƒõn!");
          loadInitial(); // refreshneme preview
        } else {
          alert("‚ùå Avatar se nepoda≈ôilo zmƒõnit: " + (resp.error || "nezn√°m√° chyba"));
        }
      })
      .catch(err => {
        console.error(err);
        alert("‚ùå Nepoda≈ôilo se spojit se serverem (/upload-avatar).");
      });
    }

    // LOG MODAL
    async function openLogs() {
      const backdrop = document.getElementById('logModalBackdrop');
      const pre = document.getElementById('logModalContent');
      pre.textContent = "Naƒç√≠t√°m‚Ä¶";

      try {
        const res = await fetch("/logs");
        if (!res.ok) {
          pre.textContent = "‚ùå Nepoda≈ôilo se naƒç√≠st logy.";
        } else {
          const text = await res.text();
          pre.textContent = text || "(pr√°zdn√Ω log)";
        }
      } catch (err) {
        console.error(err);
        pre.textContent = "‚ùå Chyba p≈ôi fetchi /logs.";
      }

      backdrop.style.display = "flex";
    }

    function closeLogs() {
      const backdrop = document.getElementById('logModalBackdrop');
      backdrop.style.display = "none";
    }

    // init page load
    window.addEventListener('DOMContentLoaded', () => {
      loadInitial();
    });
  </script>

</body>
</html>
